<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sentence Practice</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hi+Melody&family=Gamja+Flower&family=Gaegu&display=swap" rel="stylesheet">
    <style>
        :root {
            --korean-font: Arial;
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
            max-width: 500px;
            width: 100%;
        }
        .header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 10px;
        }
        h1 { color: #00f2fe; font-size: 22px; flex: 1; }
        .back-button, .font-button {
            background: #e9ecef;
            border: none;
            border-radius: 8px;
            width: 36px; height: 36px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #333;
            text-decoration: none;
        }
        .font-button { background: linear-gradient(135deg, #845ef7 0%, #7950f2 100%); color: white; }
        .back-button:hover, .font-button:hover { transform: scale(1.08); }
        .category-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }
        .category-btn {
            padding: 10px 5px;
            background: #e9ecef;
            color: #495057;
            border: 2px solid transparent;
            font-size: 14px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        .category-btn.active {
            background: #00f2fe;
            color: white;
            border-color: #00f2fe;
        }
        .sub-category-container {
            display: none;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
            margin-bottom: 15px;
        }
        .sub-category-container.show { display: grid; }
        .sub-btn {
            padding: 8px 4px;
            background: #f1f3f5;
            color: #495057;
            border: 2px solid transparent;
            font-size: 13px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .sub-btn.active {
            background: #00d4ff;
            color: white;
            border-color: #00d4ff;
        }
        .progress {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .progress.checked::after { content: " ‚úì"; color: #51cf66; font-weight: bold; }
        .sentence-display { text-align: center; margin-bottom: 20px; }
        .current-sentence {
            font-size: 32px;
            color: #00f2fe;
            margin-bottom: 10px;
            font-weight: bold;
            line-height: 1.4;
            font-family: var(--korean-font), Arial, sans-serif;
        }
        .sentence-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .info-row { margin-bottom: 8px; font-size: 14px; }
        .info-label { color: #666; margin-right: 8px; font-weight: bold; }
        .info-value { color: #333; }

        .canvas-container {
            position: relative;
            width: 100%;
            padding-bottom: 50%;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
        }
        canvas {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            border: 3px solid #00f2fe;
            border-radius: 10px;
            background: white;
            touch-action: none;
        }
        .guide-canvas { opacity: 0.25; pointer-events: none; }  /* Îçî Ìà¨Î™ÖÌïòÍ≤å */

        .controls, .controls-three {
            display: grid;
            gap: 10px;
            margin-bottom: 10px;
        }
        .controls { grid-template-columns: 1fr 1fr; }
        .controls-three { grid-template-columns: repeat(3, 1fr); }

        button {
            padding: 14px 12px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        .btn-clear { background: #ff6b9d; color: white; }
        .btn-clear:hover { background: #ff5252; }
        .btn-next, .btn-prev { background: #51cf66; color: white; }
        .btn-next:hover, .btn-prev:hover { background: #40c057; }
        .btn-show-guide { background: #ffd43b; color: #333; }
        .btn-show-guide:hover { background: #fcc419; }
        .btn-done { background: #845ef7; color: white; }
        .btn-done.checked { background: #51cf66; }

        .modal-overlay {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,0.7);
            justify-content: center; align-items: center;
            z-index: 1000;
        }
        .modal-overlay.show { display: flex; }
        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 90vw;
            max-height: 85vh;
            overflow-y: auto;
        }
        .modal-header {
            padding: 16px 20px;
            border-bottom: 2px solid #f1f3f5;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #e9ecef;
            border: none;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .font-option {
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
        }
        .font-option:hover { background: #e9ecef; }
        .font-option.active { background: #00f2fe; color: white; border-color: #00f2fe; }
        .font-option-preview { font-size: 32px; margin: 8px 0; font-weight: bold; }

        @media (max-width: 480px) {
            .current-sentence { font-size: 26px; }
            .font-option-preview { font-size: 26px; }
            .sub-category-container { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <a href="index.html" class="back-button">‚Üê</a>
        <h1>Sentence Practice</h1>
        <button class="font-button" id="fontBtn">F</button>
    </div>

    <div class="category-selector">
        <button class="category-btn active" data-category="greetings">Greetings</button>
        <button class="category-btn" data-category="basic">Basic</button>
        <button class="category-btn" id="situationMainBtn">Situation</button>
    </div>

    <div class="sub-category-container" id="subCategories">
        <button class="sub-btn active" data-sub="travel">Ïó¨Ìñâ</button>
        <button class="sub-btn" data-sub="business">ÎπÑÏ¶àÎãàÏä§</button>
        <button class="sub-btn" data-sub="restaurant">ÏãùÎãπ</button>
        <button class="sub-btn" data-sub="appointment">ÏïΩÏÜç</button>
        <button class="sub-btn" data-sub="hospital">Î≥ëÏõê</button>
    </div>

    <div class="progress" id="progressText">1 / 10</div>

    <div class="sentence-display">
        <div class="current-sentence" id="currentSentence">ÏïàÎÖïÌïòÏÑ∏Ïöî</div>
        <div class="sentence-info">
            <div class="info-row">
                <span class="info-label">Romanization:</span>
                <span id="romanization">annyeonghaseyo</span>
            </div>
            <div class="info-row">
                <span class="info-label">English:</span>
                <span id="english">Hello</span>
            </div>
        </div>
    </div>

    <div class="canvas-container">
        <canvas id="drawingCanvas"></canvas>
        <canvas id="guideCanvas" class="guide-canvas"></canvas>
    </div>

    <div class="controls">
        <button class="btn-prev">‚óÄ Previous</button>
        <button class="btn-next">Next ‚ñ∂</button>
    </div>

    <div class="controls controls-three">
        <button class="btn-clear">üóë Clear</button>
        <button class="btn-show-guide">üëÅ Guide</button>
        <button class="btn-done" id="doneBtn">‚úì Done</button>
    </div>
</div>

<!-- Font Modal -->
<div class="modal-overlay" id="fontModal">
    <div class="modal-content" style="max-width:380px;">
        <div class="modal-header">
            <h2>üî§ Font</h2>
            <button class="modal-close">√ó</button>
        </div>
        <div style="padding:20px;">
            <div class="font-option active" data-font="Arial">
                <div class="font-option-preview" style="font-family:Arial;">ÏïàÎÖïÌïòÏÑ∏Ïöî</div>
                <div>Default (Arial)</div>
            </div>
            <div class="font-option" data-font="'Hi Melody'">
                <div class="font-option-preview" style="font-family:'Hi Melody';">ÏïàÎÖïÌïòÏÑ∏Ïöî</div>
                <div>Hi Melody</div>
            </div>
            <div class="font-option" data-font="'Gamja Flower'">
                <div class="font-option-preview" style="font-family:'Gamja Flower';">ÏïàÎÖïÌïòÏÑ∏Ïöî</div>
                <div>Gamja Flower</div>
            </div>
            <div class="font-option" data-font="'Gaegu'">
                <div class="font-option-preview" style="font-family:'Gaegu';">ÏïàÎÖïÌïòÏÑ∏Ïöî</div>
                <div>Gaegu</div>
            </div>
        </div>
    </div>
</div>

<script>
// Îç∞Ïù¥ÌÑ∞ (Í∏∞Ï°¥ Í∑∏ÎåÄÎ°ú)
const sentenceData = {
    greetings: [
        { korean: 'ÏïàÎÖïÌïòÏÑ∏Ïöî', rom: 'annyeonghaseyo', eng: 'Hello (formal)' },
        { korean: 'ÏïàÎÖï', rom: 'annyeong', eng: 'Hi / Bye (informal)' },
        { korean: 'Ïûò ÏßÄÎÉàÏñ¥Ïöî?', rom: 'jal jinaesseoyo?', eng: 'How have you been?' },
        { korean: 'Ïò§ÎûúÎßåÏù¥ÏóêÏöî', rom: 'oraenmanieyo', eng: 'Long time no see' },
        { korean: 'ÎßåÎÇòÏÑú Î∞òÍ∞ÄÏõåÏöî', rom: 'mannaseo bangawoyo', eng: 'Nice to meet you' },
        { korean: 'ÏïàÎÖïÌûà Í∞ÄÏÑ∏Ïöî', rom: 'annyeonghi gaseyo', eng: 'Goodbye (to person leaving)' },
        { korean: 'ÏïàÎÖïÌûà Í≥ÑÏÑ∏Ïöî', rom: 'annyeonghi gyeseyo', eng: 'Goodbye (to person staying)' },
        { korean: 'Ï¢ãÏùÄ ÏïÑÏπ®Ïù¥ÏóêÏöî', rom: 'joheun achimieyo', eng: 'Good morning' },
        { korean: 'Ïûò Ïû§Ïñ¥Ïöî?', rom: 'jal jasseoyo?', eng: 'Did you sleep well?' },
        { korean: 'Ïò§ÎäòÎèÑ ÌôîÏù¥ÌåÖ!', rom: 'oneuldo hwaiting!', eng: 'Fighting today too!' }
    ],
    basic: [
        { korean: 'Í∞êÏÇ¨Ìï©ÎãàÎã§', rom: 'gamsahamnida', eng: 'Thank you (formal)' },
        { korean: 'Í≥†ÎßàÏõåÏöî', rom: 'gomawoyo', eng: 'Thank you (polite)' },
        { korean: 'ÎØ∏ÏïàÌï©ÎãàÎã§', rom: 'mianhamnida', eng: 'I\'m sorry (formal)' },
        { korean: 'Í¥úÏ∞ÆÏïÑÏöî', rom: 'gwaenchanayo', eng: 'It\'s okay' },
        { korean: 'ÎÑ§', rom: 'ne', eng: 'Yes' },
        { korean: 'ÏïÑÎãàÏöî', rom: 'aniyo', eng: 'No' },
        { korean: 'Ïûò Î∂ÄÌÉÅÎìúÎ†§Ïöî', rom: 'jal butakdeuryeoyo', eng: 'Please take care of me' },
        { korean: 'Ï≤úÎßåÏóêÏöî', rom: 'cheonmaneyo', eng: 'You\'re welcome' },
        { korean: 'Ï∂ïÌïòÌï¥Ïöî', rom: 'chukhahaeyo', eng: 'Congratulations' },
        { korean: 'ÏàòÍ≥†ÌïòÏÑ∏Ïöî', rom: 'sugohaseyo', eng: 'Good work / Take care' }
    ],
    travel: [
        { korean: 'Ïó¨Í∏∞ÏÑú ÏÑúÏö∏Ïó≠ÍπåÏßÄ Ïñ¥ÎñªÍ≤å Í∞ÄÏöî?', rom: 'yeogiseo seoullyeokkkaji eotteoke gayo?', eng: 'How do I get to Seoul Station from here?' },
        { korean: 'ÌÉùÏãú ÌÉÄÍ≥† Ïã∂Ïñ¥Ïöî', rom: 'taeksi tago sipeoyo', eng: 'I want to take a taxi' },
        { korean: 'Ïù¥ Ìò∏ÌÖî Ï£ºÏÜåÏòàÏöî', rom: 'i hotel jusoyeyo', eng: 'This is the hotel address' },
        { korean: 'ÏÇ¨ÏßÑ Ìïú Ïû• Ï∞çÏñ¥Ï£ºÏÑ∏Ïöî', rom: 'sajin han jang jjigeojuseyo', eng: 'Please take a photo for me' },
        { korean: 'ÌôîÏû•Ïã§Ïù¥ Ïñ¥ÎîîÏòàÏöî?', rom: 'hwajangsiri eodiyeyo?', eng: 'Where is the restroom?' },
        { korean: 'Ïù¥Í±∞ ÏñºÎßàÏòàÏöî?', rom: 'igeo eolmayeyo?', eng: 'How much is this?' },
        { korean: 'ÏòÅÏàòÏ¶ù Ï£ºÏÑ∏Ïöî', rom: 'yeongsujeung juseyo', eng: 'Please give me a receipt' },
        { korean: 'ÏßÄÌïòÏ≤† Ïñ¥ÎîîÏÑú ÌÉÄÏöî?', rom: 'jihacheol eodiseo tayo?', eng: 'Where do I get on the subway?' },
        { korean: 'Í≥µÌï≠ÍπåÏßÄ ÏñºÎßàÎÇò Í±∏Î†§Ïöî?', rom: 'gonghangkkaji eolmana geollyeoyo?', eng: 'How long does it take to the airport?' },
        { korean: 'Í∞êÏÇ¨Ìï©ÎãàÎã§, Ïûò Î∂ÄÌÉÅÎìúÎ†§Ïöî', rom: 'gamsahamnida, jal butakdeuryeoyo', eng: 'Thank you, please take care of me' }
    ],
    business: [
        { korean: 'ÌöåÏùò ÏãúÏûëÌïòÍ≤†ÏäµÎãàÎã§', rom: 'hoeui sijakhagetseumnida', eng: 'Let‚Äôs start the meeting' },
        { korean: 'ÏûêÎ£åÎ•º Î≥¥ÎÇ¥ÎìúÎ¶¥Í≤åÏöî', rom: 'jaryoreul bonaedeurilgeyo', eng: 'I‚Äôll send you the materials' },
        { korean: 'Í≥ÑÏïΩÏÑú ÌôïÏù∏ Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§', rom: 'gyeyakseo hwagin butakdeurimnida', eng: 'Please review the contract' },
        { korean: 'Í∞ÄÍ≤©ÏùÑ Ï°∞Ï†ïÌï† Ïàò ÏûàÏùÑÍπåÏöî?', rom: 'gagyeogeul jojeonghal su isseulkkayo?', eng: 'Can we adjust the price?' },
        { korean: 'Îã§Ïùå ÎØ∏ÌåÖÏùÄ Ïñ∏Ï†úÏòàÏöî?', rom: 'daeum mitingeun eonjeyeyo?', eng: 'When is the next meeting?' },
        { korean: 'Ï¢ãÏùÄ Ï†úÏïà Í∞êÏÇ¨Ìï©ÎãàÎã§', rom: 'joheun jean gamsahamnida', eng: 'Thank you for the good suggestion' },
        { korean: 'ÌòëÎ†• Í∏∞ÎåÄÌïòÍ≤†ÏäµÎãàÎã§', rom: 'hyeomnyeok gidaehagetseumnida', eng: 'I look forward to our cooperation' },
        { korean: 'Ïò§Îäò ÏàòÍ≥† ÎßéÏúºÏÖ®ÏäµÎãàÎã§', rom: 'oneul sugo maneusyeotseumnida', eng: 'Thank you for your hard work today' },
        { korean: 'Î™ÖÌï® Ï£ºÏÑ∏Ïöî', rom: 'myeongham juseyo', eng: 'Please give me your business card' },
        { korean: 'ÏßàÎ¨∏ ÏûàÏúºÏã†Í∞ÄÏöî?', rom: 'jilmun isseusin-gayo?', eng: 'Do you have any questions?' }
    ],
    restaurant: [
        { korean: 'Î©îÎâ¥Ìåê Ï£ºÏÑ∏Ïöî', rom: 'menyupan juseyo', eng: 'Please give me the menu' },
        { korean: 'Ïù¥Í±∞ Ï∂îÏ≤úÌï¥Ïöî', rom: 'igeo chucheonhaeyo', eng: 'I recommend this' },
        { korean: 'Ïó¨Í∏∞ÏÑú Ï†úÏùº ÎßõÏûàÎäî Í±∞ Ï£ºÏÑ∏Ïöî', rom: 'yeogiseo jeil masinneun geo juseyo', eng: 'Please give me the best dish here' },
        { korean: 'ÎßµÍ≤å Ìï¥Ï£ºÏÑ∏Ïöî', rom: 'maepge haejuseyo', eng: 'Please make it spicy' },
        { korean: 'Î¨º Îçî Ï£ºÏÑ∏Ïöî', rom: 'mul deo juseyo', eng: 'More water, please' },
        { korean: 'Í≥ÑÏÇ∞Ìï†Í≤åÏöî', rom: 'gyesanhalgeyo', eng: 'I‚Äôll pay now' },
        { korean: 'ÎßõÏûàÏóàÏäµÎãàÎã§', rom: 'masisseotseumnida', eng: 'It was delicious' },
        { korean: 'Ìè¨Ïû•Ìï¥ Ï£ºÏÑ∏Ïöî', rom: 'pojanghae juseyo', eng: 'Please pack it to go' },
        { korean: 'Î∞• Îçî Ï£ºÏÑ∏Ïöî', rom: 'bap deo juseyo', eng: 'More rice, please' },
        { korean: 'Ïûò Î®πÍ≤†ÏäµÎãàÎã§', rom: 'jal meokgetseumnida', eng: 'I will eat well' }
    ],
    appointment: [
        { korean: 'ÎÇ¥Ïùº Î™á ÏãúÏóê ÎßåÎÇòÏöî?', rom: 'naeil myeot sie mannayo?', eng: 'What time shall we meet tomorrow?' },
        { korean: 'ÏïΩÏÜç ÏãúÍ∞Ñ ÏßÄÌÇ¨Í≤åÏöî', rom: 'yaksok sigan jikilgeyo', eng: 'I‚Äôll keep the appointment time' },
        { korean: 'Îä¶Ïñ¥ÏÑú ÎØ∏ÏïàÌï¥Ïöî', rom: 'neujeoseo mianhaeyo', eng: 'Sorry I‚Äôm late' },
        { korean: 'Ïû•ÏÜå Î∞îÍøÄÍπåÏöî?', rom: 'jangso bakkulkka yo?', eng: 'Shall we change the place?' },
        { korean: 'Ï∑®ÏÜåÌï¥ÏïºÍ≤†Ïñ¥Ïöî', rom: 'chwisohae yagesseoyo', eng: 'I think I have to cancel' },
        { korean: 'Îã§ÏùåÏóê Îã§Ïãú ÏïΩÏÜçÌï¥Ïöî', rom: 'daeume dasi yaksokhaeyo', eng: 'Let‚Äôs make another appointment next time' },
        { korean: 'Î™á ÏãúÍπåÏßÄ Í∞ÄÎä•Ìï¥Ïöî?', rom: 'myeot sikkaji ganeunghaeyo?', eng: 'Until what time are you available?' },
        { korean: 'ÏïΩÏÜç ÏûäÏßÄ ÏïäÏùÑÍ≤åÏöî', rom: 'yaksok ijji anheulgeyo', eng: 'I won‚Äôt forget the appointment' },
        { korean: 'ÎßåÎÇòÏÑú Ï¢ãÏïòÏñ¥Ïöî', rom: 'mannaseo joasseoyo', eng: 'It was nice meeting you' },
        { korean: 'ÏãúÍ∞Ñ ÎßûÏ∂∞ÏÑú Í∞àÍ≤åÏöî', rom: 'sigan machwoseo galgeyo', eng: 'I‚Äôll come on time' }
    ],
    hospital: [
        { korean: 'Ïñ¥ÎîîÍ∞Ä ÏïÑÌîÑÏÑ∏Ïöî?', rom: 'eodiga apeuseyo?', eng: 'Where does it hurt?' },
        { korean: 'Ïó¥Ïù¥ ÏûàÏñ¥Ïöî', rom: 'yeori isseoyo', eng: 'I have a fever' },
        { korean: 'Í∞êÍ∏∞ Í±∏Î¶∞ Í≤É Í∞ôÏïÑÏöî', rom: 'gamgi geollin geot gatayo', eng: 'I think I have a cold' },
        { korean: 'Ï≤òÎ∞©Ï†Ñ Ï£ºÏÑ∏Ïöî', rom: 'cheobangjeon juseyo', eng: 'Please give me a prescription' },
        { korean: 'ÏïΩÍµ≠ Ïñ¥ÎîîÏòàÏöî?', rom: 'yakguk eodiyeyo?', eng: 'Where is the pharmacy?' },
        { korean: 'Ï£ºÏÇ¨ ÎßûÏïÑÏïº ÌïòÎÇòÏöî?', rom: 'jusa majaya hanayo?', eng: 'Do I need an injection?' },
        { korean: 'Ïñ∏Ï†ú Îã§Ïãú Ïò§Î©¥ ÎêòÎÇòÏöî?', rom: 'eonje dasi omyeon doenayo?', eng: 'When should I come back?' },
        { korean: 'ÏïåÎ†àÎ•¥Í∏∞ ÏûàÏñ¥Ïöî', rom: 'allereugi isseoyo', eng: 'I have an allergy' },
        { korean: 'ÌîºÍ≥§Ìï¥Ïöî', rom: 'pigonhaeyo', eng: 'I feel tired' },
        { korean: 'Îπ®Î¶¨ ÎÇòÏïòÏúºÎ©¥ Ï¢ãÍ≤†Ïñ¥Ïöî', rom: 'ppalli naasseumyeon jokesseoyo', eng: 'I hope I get better soon' }
    ]
};

// ÏÉÅÌÉú Î≥ÄÏàò
let currentCategory = 'greetings';
let currentSubCategory = null;
let currentIndex = 0;
let isDrawing = false;
let showGuide = true;
let checkedSentences = {};

try {
    const saved = localStorage.getItem('sentenceChecked');
    if (saved) checkedSentences = JSON.parse(saved);
} catch(e) {}

// Ï∫îÎ≤ÑÏä§ Ï¥àÍ∏∞Ìôî
const canvas = document.getElementById('drawingCanvas');
const guideCanvas = document.getElementById('guideCanvas');
const ctx = canvas.getContext('2d');
const guideCtx = guideCanvas.getContext('2d');

function initCanvas() {
    const container = document.querySelector('.canvas-container');
    const w = container.offsetWidth;
    const h = w * 0.5;
    const dpr = window.devicePixelRatio || 1;

    canvas.style.width = w + 'px';
    canvas.style.height = h + 'px';
    canvas.width = w * dpr;
    canvas.height = h * dpr;

    guideCanvas.style.width = w + 'px';
    guideCanvas.style.height = h + 'px';
    guideCanvas.width = w * dpr;
    guideCanvas.height = h * dpr;

    ctx.scale(dpr, dpr);
    guideCtx.scale(dpr, dpr);

    ctx.lineWidth = 6;
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
    ctx.strokeStyle = '#0066ff';

    updateGuide();
}

function updateGuide() {
    guideCtx.clearRect(0, 0, guideCanvas.width / window.devicePixelRatio, guideCanvas.height / window.devicePixelRatio);
    const text = getCurrentSentence().korean;
    
    const canvasWidth = guideCanvas.width / window.devicePixelRatio;
    const canvasHeight = guideCanvas.height / window.devicePixelRatio;
    
    // CSS Î≥ÄÏàò Í∞íÏùÑ Ïã§Ï†úÎ°ú Í∞ÄÏ†∏Ïò§Í∏∞
    const currentFont = getComputedStyle(document.documentElement).getPropertyValue('--korean-font').trim() || 'Arial';
    
    // 7Í∏ÄÏûê Ïù¥ÏÉÅÏù¥Í≥† Ï§ëÍ∞ÑÏóê ÎùÑÏñ¥Ïì∞Í∏∞Í∞Ä ÏûàÎäî Í≤ΩÏö∞ 2Ï§ÑÎ°ú ÌëúÏãú
    if (text.length > 7 && text.includes(' ')) {
        const spaceIndex = text.indexOf(' ', Math.floor(text.length / 2) - 2);
        
        if (spaceIndex > 0 && spaceIndex < text.length - 1) {
            const line1 = text.substring(0, spaceIndex);
            const line2 = text.substring(spaceIndex + 1);
            
            // 2Ï§Ñ ÌÖçÏä§Ìä∏ ÌÅ¨Í∏∞ Í≥ÑÏÇ∞
            let fontSize = canvasHeight * 0.35;
            guideCtx.font = `bold ${fontSize}px ${currentFont}, Arial, sans-serif`;
            
            let line1Width = guideCtx.measureText(line1).width;
            let line2Width = guideCtx.measureText(line2).width;
            const maxTextWidth = Math.max(line1Width, line2Width);
            const maxWidth = canvasWidth * 0.95;
            
            if (maxTextWidth > maxWidth) {
                fontSize = fontSize * (maxWidth / maxTextWidth);
                guideCtx.font = `bold ${fontSize}px ${currentFont}, Arial, sans-serif`;
            }
            
            fontSize = Math.max(25, Math.min(fontSize, canvasHeight * 0.4));
            
            guideCtx.font = `bold ${fontSize}px ${currentFont}, Arial, sans-serif`;
            guideCtx.fillStyle = 'rgba(0, 242, 254, 0.4)';  // Ìà¨Î™ÖÎèÑ Ï†ÅÏö©
            guideCtx.textAlign = 'center';
            guideCtx.textBaseline = 'middle';
            
            const lineSpacing = fontSize * 1.2;
            const centerY = canvasHeight / 2;
            
            guideCtx.fillText(line1, canvasWidth / 2, centerY - lineSpacing / 2);
            guideCtx.fillText(line2, canvasWidth / 2, centerY + lineSpacing / 2);
            
            return;
        }
    }
    
    // 1Ï§Ñ ÌëúÏãú (Í∏∞Ï°¥ Î°úÏßÅ)
    let fontSize = canvasHeight * 0.7;
    guideCtx.font = `bold ${fontSize}px ${currentFont}, Arial, sans-serif`;
    
    let textWidth = guideCtx.measureText(text).width;
    const maxWidth = canvasWidth * 0.95;
    
    if (textWidth > maxWidth) {
        fontSize = fontSize * (maxWidth / textWidth);
        guideCtx.font = `bold ${fontSize}px ${currentFont}, Arial, sans-serif`;
    }
    
    fontSize = Math.max(30, Math.min(fontSize, canvasHeight * 0.8));
    
    guideCtx.font = `bold ${fontSize}px ${currentFont}, Arial, sans-serif`;
    guideCtx.fillStyle = 'rgba(0, 242, 254, 0.4)';  // Ìà¨Î™ÖÎèÑ Ï†ÅÏö©
    guideCtx.textAlign = 'center';
    guideCtx.textBaseline = 'middle';
    guideCtx.fillText(text, canvasWidth / 2, canvasHeight / 2);
}
function getCurrentSentence() {
    if (currentCategory === 'situation' && currentSubCategory) {
        return sentenceData[currentSubCategory][currentIndex];
    }
    return sentenceData[currentCategory][currentIndex];
}

function getCategoryLength() {
    if (currentCategory === 'situation' && currentSubCategory) {
        return sentenceData[currentSubCategory].length;
    }
    return sentenceData[currentCategory].length;
}

function getKey() {
    if (currentCategory === 'situation' && currentSubCategory) {
        return `situation-${currentSubCategory}-${currentIndex}`;
    }
    return `${currentCategory}-${currentIndex}`;
}

function updateDisplay() {
    const s = getCurrentSentence();
    document.getElementById('currentSentence').textContent = s.korean;
    document.getElementById('romanization').textContent = s.rom;
    document.getElementById('english').textContent = s.eng;

    const progress = document.getElementById('progressText');
    progress.textContent = `${currentIndex + 1} / ${getCategoryLength()}`;
    
    const checked = !!checkedSentences[getKey()];
    progress.classList.toggle('checked', checked);
    document.getElementById('doneBtn').classList.toggle('checked', checked);
}

// ÎìúÎ°úÏûâ Ìï®ÏàòÎì§ (Í∏∞Ï°¥Í≥º ÎèôÏùº)
function getPos(e) {
    const r = canvas.getBoundingClientRect();
    const t = e.touches ? e.touches[0] : e;
    return {
        x: t.clientX - r.left,
        y: t.clientY - r.top
    };
}

function startDrawing(e) { e.preventDefault(); isDrawing = true; const p = getPos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); }
function draw(e) { if(!isDrawing) return; e.preventDefault(); const p = getPos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); }
function stopDrawing() { isDrawing = false; }
function clearCanvas() { ctx.clearRect(0,0,canvas.width,canvas.height); }
function toggleGuide() {
    showGuide = !showGuide;
    guideCanvas.style.opacity = showGuide ? '0.25' : '0';
}

// ÌéòÏù¥ÏßÄ Ïù¥Îèô
function nextSentence() {
    currentIndex = (currentIndex + 1) % getCategoryLength();
    updateDisplay();
    clearCanvas();
    updateGuide();
}

function prevSentence() {
    currentIndex = (currentIndex - 1 + getCategoryLength()) % getCategoryLength();
    updateDisplay();
    clearCanvas();
    updateGuide();
}

function toggleDone() {
    const key = getKey();
    checkedSentences[key] = !checkedSentences[key];
    localStorage.setItem('sentenceChecked', JSON.stringify(checkedSentences));
    updateDisplay();
}

// Ìè∞Ìä∏ ÏÑ†ÌÉù (Í∏∞Ï°¥Í≥º ÎèôÏùº)
document.getElementById('fontBtn').onclick = () => {
    document.getElementById('fontModal').classList.add('show');
};

document.querySelector('.modal-close').onclick = () => {
    document.getElementById('fontModal').classList.remove('show');
};

document.querySelectorAll('.font-option').forEach(opt => {
    opt.onclick = function() {
        const font = this.dataset.font;
        document.documentElement.style.setProperty('--korean-font', font);
        document.querySelectorAll('.font-option').forEach(o => o.classList.remove('active'));
        this.classList.add('active');
        updateGuide();
        try { localStorage.setItem('sentenceFont', font); } catch(e){}
    };
});

const savedFont = localStorage.getItem('sentenceFont');
if (savedFont) {
    document.documentElement.style.setProperty('--korean-font', savedFont);
    const activeOpt = document.querySelector(`.font-option[data-font="${savedFont.replace(/'/g,'')}"]`);
    if (activeOpt) activeOpt.classList.add('active');
}

// Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÑ†ÌÉù (Greetings, Basic)
document.querySelectorAll('.category-btn[data-category]').forEach(btn => {
    btn.onclick = function() {
        document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentCategory = this.dataset.category;
        currentIndex = 0;
        currentSubCategory = null;
        document.getElementById('subCategories').classList.remove('show');
        updateDisplay();
        clearCanvas();
        updateGuide();
    };
});

// Situation Î≤ÑÌäº ÌÅ¥Î¶≠ ‚Üí ÏÑúÎ∏å Î©îÎâ¥ ÌÜ†Í∏Ä
document.getElementById('situationMainBtn').onclick = function() {
    const subContainer = document.getElementById('subCategories');
    const isOpening = !subContainer.classList.contains('show');
    
    // Îã§Î•∏ Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
    
    // sub Î≤ÑÌäº Ï¥àÍ∏∞Ìôî
    document.querySelectorAll('.sub-btn').forEach(b => b.classList.remove('active'));
    
    if (isOpening) {
        // ÏÑúÎ∏å Î©îÎâ¥ Ïó¥Í∏∞
        subContainer.classList.add('show');
        currentCategory = 'situation';
        currentSubCategory = 'travel';
        currentIndex = 0;
        document.querySelector('[data-sub="travel"]').classList.add('active');
        updateDisplay();
        clearCanvas();
        updateGuide();
    } else {
        // ÏÑúÎ∏å Î©îÎâ¥ Îã´Í∏∞
        subContainer.classList.remove('show');
        currentSubCategory = null;
    }
};

// ‚òÖ‚òÖ‚òÖ Ï§ëÏöî ‚òÖ‚òÖ‚òÖ Sub Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ (Ïó¨Í∏∞ÏÑú Ìï¥Í≤∞!)
document.querySelectorAll('.sub-btn[data-sub]').forEach(btn => {
    btn.onclick = function() {
        document.querySelectorAll('.sub-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        currentCategory = 'situation';
        currentSubCategory = this.dataset.sub;
        currentIndex = 0;
        
        updateDisplay();
        clearCanvas();
        updateGuide();
    };
});

// Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ïó∞Í≤∞
canvas.addEventListener('mousedown', startDrawing);
canvas.addEventListener('mousemove', draw);
canvas.addEventListener('mouseup', stopDrawing);
canvas.addEventListener('mouseout', stopDrawing);
canvas.addEventListener('touchstart', startDrawing);
canvas.addEventListener('touchmove', draw);
canvas.addEventListener('touchend', stopDrawing);

document.querySelector('.btn-next').onclick = nextSentence;
document.querySelector('.btn-prev').onclick = prevSentence;
document.querySelector('.btn-clear').onclick = clearCanvas;
document.querySelector('.btn-show-guide').onclick = toggleGuide;
document.getElementById('doneBtn').onclick = toggleDone;

window.addEventListener('resize', initCanvas);

// Ï¥àÍ∏∞ Ïã§Ìñâ
initCanvas();
updateDisplay();
</script>
</body>
</html>
